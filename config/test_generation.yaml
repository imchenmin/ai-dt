# Test Generation Configuration
# This file configures test generation parameters for different projects and scenarios

# Default configuration for all projects
defaults:
  llm_provider: "deepseek"
  model: "deepseek-coder"
  max_tokens: 2500
  temperature: 0.3
  output_dir: "./experiment/generated_tests"
  
  # Error handling configuration
  error_handling:
    max_retries: 3
    retry_delay: 1.0
    max_delay: 60.0
    backoff_factor: 2.0
  
  # Function filtering options
  filter:
    skip_std_lib: true
    skip_compiler_builtins: true
    skip_operators: true
    skip_special_functions: true
    custom_include_patterns: []
    custom_exclude_patterns: []

  # Context compression options
  context_compression:
    enabled: true  # Enable/disable context compression
    compression_level: 1  # Compression level: 0=minimal, 1=balanced, 2=aggressive
    max_context_size: null  # Optional max context size override

# Project-specific configurations
projects:
  # Simple C project
  simple_c:
    path: "test_projects/c"
    comp_db: "test_projects/c/compile_commands.json"
    description: "Simple C math utilities project"

  # Complex C++ project
  complex_example:
    path: "test_projects/complex_example"
    comp_db: "test_projects/complex_example/compile_commands.json"
    description: "Complex C++ math library with templates and exceptions"
    
    # Custom output directory for this project
    output_dir: "./experiment/generated_tests_complex"

  # Complex C project with data structures and algorithms
  complex_c_project:
    path: "test_projects/complex_c_project"
    comp_db: "test_projects/complex_c_project/compile_commands.json"
    unit_test_directory_path: "test_projects/complex_c_project/tests" # New optional path
    description: "Complex C project with data structures, algorithms and memory utilities"
    
    # Use Dify API for this project
    llm_provider: "dify"
    model: "dify-model" # Model is usually set in Dify UI
    
    # Custom output directory for this project
    output_dir: "./experiment/generated_tests_complex_c"
    filter:
      skip_std_lib: true
      skip_compiler_builtins: true
      skip_operators: true
      skip_special_functions: true
      custom_include_patterns: []
      custom_exclude_patterns: []

  # Redis C project (real-world scenario)
  redis:
    path: "test_projects/redis"
    comp_db: "test_projects/redis/compile_commands.json"
    description: "Redis key-value store project for real-world C testing scenarios"
    
    # Custom output directory for this project
    output_dir: "./experiment/generated_tests_redis"
    include_patterns: ["src/redis-cli.c"]
    filter:
      skip_std_lib: true
      skip_compiler_builtins: true
      skip_operators: true
      skip_special_functions: true
      custom_include_patterns: []
      custom_exclude_patterns: []

  # Example: Project with selective parsing
  selective_parsing_example:
    path: "test_projects/complex_c_project"
    comp_db: "test_projects/complex_c_project/compile_commands.json"
    description: "Example project demonstrating selective parsing"
    
    # Only analyze files in specific directories
    include_patterns: ["src/data_structures/", "src/algorithms/"]
    
    # Exclude specific files or directories
    exclude_patterns: ["src/third_party/", "vendor/"]
    
    filter:
      skip_std_lib: true
      skip_compiler_builtins: true
      skip_operators: true
      skip_special_functions: true

# LLM provider configurations
llm_providers:
  deepseek:
    api_key_env: "DEEPSEEK_API_KEY"
    base_url: "https://api.deepseek.com/v1"
    models:
      - "deepseek-chat"
      - "deepseek-coder"
    default_model: "deepseek-coder"
    
  openai:
    api_key_env: "OPENAI_API_KEY"
    base_url: "https://api.openai.com/v1"
    models:
      - "gpt-3.5-turbo"
      - "gpt-4"
      - "gpt-4-turbo"
    default_model: "gpt-3.5-turbo"
    
  anthropic:
    api_key_env: "ANTHROPIC_API_KEY"
    base_url: "https://api.anthropic.com/v1"
    models:
      - "claude-3-opus"
      - "claude-3-sonnet" 
      - "claude-3-haiku"
    default_model: "claude-3-sonnet"
    
  dify:
    api_key_env: "DIFY_API_KEY"
    base_url: "https://api.dify.ai/v1/chat-messages"
    models:
      - "dify-model" # Model name is often abstract in Dify
    default_model: "dify-model"

# Test generation templates
test_templates:
  c:
    framework: "google_test"
    includes:
      - "#include <gtest/gtest.h>"
      - "#include <mockcpp/mockcpp.hpp>"
    setup: |
      // Test setup code for C functions
    teardown: |
      // Test teardown code
      
  cpp:
    framework: "google_test"  
    includes:
      - "#include <gtest/gtest.h>"
      - "#include <mockcpp/mockcpp.hpp>"
      - "#include <cmath>"
      - "#include <stdexcept>"
    setup: |
      // Test setup code for C++ functions
    teardown: |
      // Test teardown code

# Execution profiles
profiles:
  quick:
    description: "Quick test generation with minimal coverage"
    max_functions: 3
    test_cases_per_function: 3
    max_workers: 1  # Sequential processing for quick runs
    timeout: 300  # 5 minutes
    
  comprehensive:
    description: "Comprehensive test generation with full coverage"
    max_functions: 20
    test_cases_per_function: 10
    max_workers: 3  # Concurrent processing for comprehensive runs
    timeout: 1800  # 30 minutes
    
  custom:
    description: "Custom configuration for specific needs"
    max_functions: null  # No limit
    test_cases_per_function: null  # Use function-specific settings
    max_workers: 5  # Higher concurrency for custom runs
    timeout: 3600  # 60 minutes
    
  dify:
    description: "Dify API profile with extended timeouts"
    max_functions: 5  # Limit for Dify testing
    test_cases_per_function: 5
    max_workers: 1  # Sequential for Dify stability
    timeout: 7200  # 2 hours for Dify API calls