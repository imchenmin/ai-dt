# 工作日志: 提示词重构与优化

## 日期: 2025-08-24
## 负责人: Gemini

## 1. 任务背景
当前系统生成的测试用例生成提示词（Prompt）虽然包含了丰富的信息，但在结构、引导性、上下文准确性方面存在明显不足，影响了生成测试用例的质量和稳定性。本次任务旨在对提示词进行深度重构和优化。

## 2. 原版提示词问题分析

*   **结构混乱**: 中英文标题混用，信息罗列扁平，缺乏重点。
*   **引导性不足**:
    *   缺少专家角色设定，无法充分引导LLM进入特定场景。
    *   未采用“思维链”等技巧，导致LLM直接输出代码，缺乏规划。
*   **上下文错误/缺失**:
    *   **依赖分析不准**: 将无用的`std::cout`识别为依赖，却忽略了真正需要Mock的核心类 `Statistics`。
    *   **关键定义缺失**: 提到了 `MathException` 等自定义类型，但未提供其源码定义，LLM只能靠猜测。
*   **指令模糊**: 对测试场景、断言重点等要求不够具体，导致生成代码的随机性较大。

## 3. 重构后的优化方案

为了解决上述问题，设计并实现了一套新的提示词结构。

### 优化点一览

| 优化维度 | 原版提示词 | ✅ 新版提示词 | 收益 |
| :--- | :--- | :--- | :--- |
| **角色设定** | ❌ 无 | 设定为“资深C++测试工程师” | 激活LLM的专家能力，提升代码专业性 |
| **结构化** | 扁平罗列 | 清晰的五段式结构（角色、FUT、上下文、要求、指令） | 逻辑清晰，可读性强，方便LLM解析 |
| **依赖分析** | 错误且无效 | **精准定位**到需Mock的`Statistics`类方法 | 提供了正确、可用的Mock目标 |
| **上下文** | 缺失关键定义 | **补充了**`Statistics`和`MathException`的源码 | 杜绝LLM的猜测行为，保证代码准确性 |
| **测试场景** | 模糊的“边界条件” | **具体化**为“正常流程”和“异常处理” | 使生成的测试用例更具针对性和实用性 |
| **断言指导** | ❌ 无 | 明确指出“验证与Mock的交互”，而非`cout` | 引导LLM编写更符合单元测试思想的代码 |
| **思维链** | ❌ 无 | 明确要求“先思考，再编码” | 提升生成代码的逻辑性和覆盖度 |

### 新旧提示词结构对比

**旧结构:**
- 目标函数信息
- 函数实现预览
- 依赖分析 (不准确)
- 宏定义详情
- 使用示例 (不完整)
- 编译信息
- 测试生成要求 (笼统)
- Mock要求 (笼统)

**新结构:**
1.  **角色与目标** (新增)
2.  **被测函数 (FUT)** (整合信息)
3.  **上下文与依赖** (提供精准定义)
4.  **测试生成要求** (具体化场景和断言)
5.  **指令与输出格式** (引入思维链)

## 4. 结论与价值

通过本次重构，新的提示词模板：
*   **更智能**: 能为LLM提供更精准、全面的上下文。
*   **更可控**: 通过明确的指令和角色设定，降低了生成结果的随机性。
*   **更高效**: 减少了因信息不足或错误导致的LLM“幻觉”，提升了一次生成成功率。

这将直接提升下游测试用例的质量，使其更健壮、更符合项目需求。
