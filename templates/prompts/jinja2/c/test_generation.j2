# C Unit Test Generation

**TARGET_FUNCTION**: {{target_function_name}}
**LOCATION**: {{target_location}}
**SIGNATURE**:
```c
{{function_signature}}
```

{% if function_body -%}
**IMPLEMENTATION**:
```c
{{function_body}}
```
{% endif %}

**CONTEXT_DATA**:

{% if dependency_definitions -%}
**DEPENDENCIES**:
```c
{% for dep in dependency_definitions -%}
{{dep}}
{% endfor -%}
```
{% endif %}

{% if macro_definitions -%}
**MACROS**:
```c
{% for macro in macro_definitions -%}
{{macro}}
{% endfor -%}
```
{% endif %}

{% if called_functions -%}
**CALLED_FUNCTIONS**:
{% for func in called_functions -%}
- {{func.name}}: {{func.description or 'MOCK_REQUIRED'}}
{% endfor %}
{% endif %}
{% if existing_tests and existing_tests|length > 0 -%}
**EXISTING_TEST_PATTERNS**:
```c
{% for test in existing_tests -%}
{{test}}
{% endfor -%}
```
{% endif %}

{% if dependency_analysis -%}
**DEPENDENCY_ANALYSIS**: {{dependency_analysis}}
{% endif %}

**FRAMEWORK_REQUIREMENTS**:
- Framework: Google Test (gtest)
- Test class: inherit from `::testing::Test`
- Test macros: `TEST_F`
- Assertions: `EXPECT_EQ`, `EXPECT_NE`, `EXPECT_TRUE`, `EXPECT_FALSE`, `ASSERT_*`
- C wrapper: `extern "C"` required

**MOCK_INSTRUCTIONS**:
{% if mock_guidance -%}
{{mock_guidance}}
{% else -%}
- Use MockCpp framework for function mocking
- System calls: function pointer replacement
- C functions: function pointers or conditional compilation
- Memory management: careful pointer operations
{% endif %}

**MANDATORY_TEST_SCENARIOS**:
1. Normal path: expected behavior with valid inputs
2. Boundary values: 0, -1, INT_MAX, INT_MIN
3. Error handling: invalid inputs and exceptions
4. NULL tests: null pointers, empty strings
5. Memory management: malloc/free correctness
6. Buffer overflow: string and array boundaries

**ASSERTION_RULES**:
- Every test MUST contain explicit assertions
- Verify: return values, output parameters, side effects
- Use descriptive assertion messages
- Focus on pointer and memory assertions for C

**CODE_STRUCTURE_TEMPLATE**:
{% if test_class_structure -%}
{{test_class_structure}}
{% else -%}
```cpp
extern "C" {
    #include "{{filename}}.h"
}

class {{filename}}_test : public ::testing::Test {
protected:
    void SetUp() override {
        // Initialize globals, allocate memory
    }
    void TearDown() override {
        // Free memory, reset global state
    }
};
```
{% endif %}

**NAMING_CONVENTIONS**:
- Test methods: `{{target_function_name}}_when_condition_should_result`
- Variables: descriptive_names_with_underscores

**C_LANGUAGE_CONSTRAINTS**:

**GLOBAL_VARIABLES**:
- Reset global state in SetUp/TearDown
- Test global variable side effects

**STRING_HANDLING**:
- Test string boundary conditions
- Verify null terminator handling
- Test buffer overflow protection

**GENERATION_INSTRUCTIONS**:

Generate complete C test code with:
1. Complete test file with headers and extern "C"
2. Test class with SetUp/TearDown methods
3. Multiple test cases covering all scenarios
4. Appropriate mocks (if needed)
5. Clear comments explaining test purpose
6. C coding standards compliance

**QUALITY_REQUIREMENTS**:
- Syntax correct, directly compilable
- Proper C memory management
- Clear logic, maintainable
- Comprehensive coverage
- Error handling and boundary tests
- C pointer and memory safety focus

**OUTPUT_FORMAT**: Complete C++ test file with GoogleTest framework

Generate C test code: